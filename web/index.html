<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaultic - Password Manager</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: #16213e;
            padding: 1rem 2rem;
            border-bottom: 1px solid #0f3460;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 { color: #00d9ff; font-size: 1.5rem; }
        .status { font-size: 0.9rem; color: #888; }
        .status.locked { color: #ff6b6b; }
        .status.unlocked { color: #51cf66; }
        main {
            flex: 1;
            display: flex;
            padding: 1rem;
            gap: 1rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        .sidebar {
            width: 200px;
            background: #16213e;
            border-radius: 8px;
            padding: 1rem;
        }
        .sidebar h3 { color: #00d9ff; margin-bottom: 1rem; font-size: 0.9rem; }
        .sidebar ul { list-style: none; }
        .sidebar li {
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 0.25rem;
        }
        .sidebar li:hover { background: #0f3460; }
        .sidebar li.active { background: #0f3460; color: #00d9ff; }
        .content { flex: 1; display: flex; flex-direction: column; gap: 1rem; }
        .terminal {
            background: #0d0d1a;
            border-radius: 8px;
            padding: 1rem;
            flex: 1;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .terminal-line { margin-bottom: 0.25rem; }
        .terminal-line.cmd { color: #00d9ff; }
        .terminal-line.error { color: #ff6b6b; }
        .terminal-line.success { color: #51cf66; }
        .terminal-line.info { color: #ffd93d; }
        .input-area {
            display: flex;
            background: #16213e;
            border-radius: 8px;
            overflow: hidden;
        }
        .prompt {
            background: #0f3460;
            padding: 0.75rem 1rem;
            color: #00d9ff;
            white-space: nowrap;
        }
        #cmdInput {
            flex: 1;
            background: transparent;
            border: none;
            color: #eee;
            font-family: inherit;
            font-size: 1rem;
            padding: 0.75rem;
            outline: none;
        }
        .entries-panel {
            background: #16213e;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        .entry {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #0f3460;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .entry:hover { background: #0f3460; }
        .entry:last-child { border-bottom: none; }
        .entry-name { font-weight: bold; }
        .entry-user { color: #888; font-size: 0.85rem; }
        .entry-actions { display: flex; gap: 0.5rem; }
        .btn {
            background: #0f3460;
            border: none;
            color: #eee;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .btn:hover { background: #00d9ff; color: #1a1a2e; }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: #16213e;
            border-radius: 8px;
            padding: 2rem;
            width: 400px;
            max-width: 90%;
        }
        .modal h2 { margin-bottom: 1rem; color: #00d9ff; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.25rem; color: #888; }
        .form-group input {
            width: 100%;
            background: #0d0d1a;
            border: 1px solid #0f3460;
            color: #eee;
            padding: 0.5rem;
            border-radius: 4px;
            font-family: inherit;
        }
        .form-group input:focus { outline: none; border-color: #00d9ff; }
        .modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; }
        .btn-primary { background: #00d9ff; color: #1a1a2e; }
        .help-text { color: #888; font-size: 0.8rem; margin-top: 1rem; }
    </style>
</head>
<body>
    <header>
        <h1>Vaultic</h1>
        <div class="status locked" id="status">Locked</div>
    </header>
    <main>
        <aside class="sidebar">
            <h3>Commands</h3>
            <ul>
                <li onclick="runCmd('help')">help</li>
                <li onclick="runCmd('unlock')">unlock</li>
                <li onclick="runCmd('lock')">lock</li>
                <li onclick="runCmd('list')">list</li>
                <li onclick="runCmd('add')">add</li>
                <li onclick="runCmd('generate')">generate</li>
                <li onclick="runCmd('search')">search</li>
            </ul>
        </aside>
        <div class="content">
            <div class="terminal" id="terminal">
                <div class="terminal-line info">Welcome to Vaultic Web Interface</div>
                <div class="terminal-line">Type 'help' for available commands</div>
            </div>
            <div class="entries-panel" id="entries" style="display:none;"></div>
            <div class="input-area">
                <span class="prompt">vaultic&gt;</span>
                <input type="text" id="cmdInput" placeholder="Enter command..." autofocus>
            </div>
        </div>
    </main>

    <div class="modal" id="unlockModal">
        <div class="modal-content">
            <h2>Unlock Vault</h2>
            <div class="form-group">
                <label>Master Password</label>
                <input type="password" id="unlockPassword" placeholder="Enter password">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('unlockModal')">Cancel</button>
                <button class="btn btn-primary" onclick="doUnlock()">Unlock</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-content">
            <h2>Add Entry</h2>
            <div class="form-group">
                <label>Name *</label>
                <input type="text" id="addName" placeholder="e.g., GitHub">
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="addUsername" placeholder="e.g., user@example.com">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="addPassword" placeholder="Leave empty to generate">
            </div>
            <div class="form-group">
                <label>URL</label>
                <input type="text" id="addUrl" placeholder="e.g., https://github.com">
            </div>
            <div class="form-group">
                <label>Tags (comma-separated)</label>
                <input type="text" id="addTags" placeholder="e.g., work, dev">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addModal')">Cancel</button>
                <button class="btn btn-primary" onclick="doAdd()">Add</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let isUnlocked = false;
        let entries = [];
        const API = window.location.origin + '/api';

        // Terminal output
        function print(msg, type = '') {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = 'terminal-line ' + type;
            line.textContent = msg;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal').innerHTML = '';
        }

        // Commands
        const commands = {
            help: () => {
                print('Available commands:', 'info');
                print('  unlock     - Unlock the vault');
                print('  lock       - Lock the vault');
                print('  list       - List all entries');
                print('  get <name> - Get entry details');
                print('  add        - Add new entry');
                print('  delete <n> - Delete entry');
                print('  generate   - Generate password');
                print('  search <q> - Search entries');
                print('  clear      - Clear terminal');
            },
            unlock: () => {
                if (isUnlocked) {
                    print('Vault is already unlocked', 'info');
                    return;
                }
                document.getElementById('unlockModal').classList.add('active');
            },
            lock: async () => {
                if (!isUnlocked) {
                    print('Vault is already locked', 'info');
                    return;
                }
                try {
                    await fetch(API + '/lock', { method: 'POST' });
                    isUnlocked = false;
                    updateStatus();
                    entries = [];
                    renderEntries();
                    print('Vault locked', 'success');
                } catch (e) {
                    // Demo mode
                    isUnlocked = false;
                    updateStatus();
                    entries = [];
                    renderEntries();
                    print('Vault locked (demo mode)', 'success');
                }
            },
            list: async () => {
                if (!isUnlocked) {
                    print('Error: Vault is locked', 'error');
                    return;
                }
                try {
                    const res = await fetch(API + '/entries');
                    entries = await res.json();
                } catch (e) {
                    // Demo mode - keep existing entries
                }
                if (entries.length === 0) {
                    print('No entries found', 'info');
                } else {
                    print(`Found ${entries.length} entries:`, 'info');
                    entries.forEach((e, i) => {
                        print(`  ${i+1}. ${e.name} - ${e.username || '-'}`);
                    });
                }
                renderEntries();
            },
            get: async (args) => {
                if (!isUnlocked) {
                    print('Error: Vault is locked', 'error');
                    return;
                }
                const name = args.join(' ');
                if (!name) {
                    print('Usage: get <name>', 'error');
                    return;
                }
                const entry = entries.find(e => e.name.toLowerCase().includes(name.toLowerCase()));
                if (!entry) {
                    print(`Entry not found: ${name}`, 'error');
                    return;
                }
                print(`Name: ${entry.name}`, 'info');
                print(`Username: ${entry.username || '-'}`);
                print(`Password: ${'*'.repeat(entry.password?.length || 8)}`);
                print(`URL: ${entry.url || '-'}`);
                print(`Tags: ${entry.tags?.join(', ') || '-'}`);
            },
            add: () => {
                if (!isUnlocked) {
                    print('Error: Vault is locked', 'error');
                    return;
                }
                document.getElementById('addModal').classList.add('active');
            },
            delete: async (args) => {
                if (!isUnlocked) {
                    print('Error: Vault is locked', 'error');
                    return;
                }
                const name = args.join(' ');
                if (!name) {
                    print('Usage: delete <name>', 'error');
                    return;
                }
                const idx = entries.findIndex(e => e.name.toLowerCase().includes(name.toLowerCase()));
                if (idx === -1) {
                    print(`Entry not found: ${name}`, 'error');
                    return;
                }
                try {
                    await fetch(API + `/entries/${entries[idx].id}`, { method: 'DELETE' });
                } catch (e) { /* Demo mode */ }
                const deleted = entries.splice(idx, 1)[0];
                print(`Deleted: ${deleted.name}`, 'success');
                renderEntries();
            },
            generate: () => {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                let password = '';
                const array = new Uint32Array(20);
                crypto.getRandomValues(array);
                for (let i = 0; i < 20; i++) {
                    password += chars[array[i] % chars.length];
                }
                print('Generated password:', 'info');
                print(`  ${password}`, 'success');
                navigator.clipboard.writeText(password).then(() => {
                    print('  (copied to clipboard)', 'info');
                });
            },
            search: async (args) => {
                if (!isUnlocked) {
                    print('Error: Vault is locked', 'error');
                    return;
                }
                const query = args.join(' ').toLowerCase();
                if (!query) {
                    print('Usage: search <query>', 'error');
                    return;
                }
                const results = entries.filter(e =>
                    e.name.toLowerCase().includes(query) ||
                    e.username?.toLowerCase().includes(query) ||
                    e.tags?.some(t => t.toLowerCase().includes(query))
                );
                if (results.length === 0) {
                    print(`No results for: ${query}`, 'info');
                } else {
                    print(`Found ${results.length} results:`, 'info');
                    results.forEach((e, i) => {
                        print(`  ${i+1}. ${e.name} - ${e.username || '-'}`);
                    });
                }
            },
            clear: () => clearTerminal()
        };

        function runCmd(cmd) {
            const parts = cmd.trim().split(/\s+/);
            const command = parts[0].toLowerCase();
            const args = parts.slice(1);

            print(`vaultic> ${cmd}`, 'cmd');

            if (commands[command]) {
                commands[command](args);
            } else if (command) {
                print(`Unknown command: ${command}`, 'error');
                print("Type 'help' for available commands");
            }
        }

        // Input handling
        document.getElementById('cmdInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                runCmd(e.target.value);
                e.target.value = '';
            }
        });

        // Modal functions
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        async function doUnlock() {
            const password = document.getElementById('unlockPassword').value;
            if (!password) return;

            try {
                const res = await fetch(API + '/unlock', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                if (!res.ok) throw new Error('Invalid password');
                isUnlocked = true;
                const data = await res.json();
                entries = data.entries || [];
            } catch (e) {
                // Demo mode
                isUnlocked = true;
                entries = [
                    { id: '1', name: 'GitHub', username: 'user@example.com', password: 'demo123', url: 'https://github.com', tags: ['dev', 'work'] },
                    { id: '2', name: 'Gmail', username: 'user@gmail.com', password: 'demo456', tags: ['personal'] },
                    { id: '3', name: 'AWS', username: 'admin', password: 'aws-secret', url: 'https://aws.amazon.com', tags: ['work', 'cloud'] }
                ];
            }

            updateStatus();
            renderEntries();
            closeModal('unlockModal');
            document.getElementById('unlockPassword').value = '';
            print('Vault unlocked', 'success');
        }

        async function doAdd() {
            const name = document.getElementById('addName').value;
            if (!name) {
                print('Error: Name is required', 'error');
                return;
            }

            const entry = {
                id: Date.now().toString(),
                name,
                username: document.getElementById('addUsername').value || null,
                password: document.getElementById('addPassword').value || generatePassword(),
                url: document.getElementById('addUrl').value || null,
                tags: document.getElementById('addTags').value.split(',').map(t => t.trim()).filter(Boolean)
            };

            try {
                await fetch(API + '/entries', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(entry)
                });
            } catch (e) { /* Demo mode */ }

            entries.push(entry);
            renderEntries();
            closeModal('addModal');

            // Clear form
            ['addName', 'addUsername', 'addPassword', 'addUrl', 'addTags'].forEach(id => {
                document.getElementById(id).value = '';
            });

            print(`Added: ${name}`, 'success');
        }

        function generatePassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let password = '';
            const array = new Uint32Array(20);
            crypto.getRandomValues(array);
            for (let i = 0; i < 20; i++) {
                password += chars[array[i] % chars.length];
            }
            return password;
        }

        function updateStatus() {
            const status = document.getElementById('status');
            status.textContent = isUnlocked ? 'Unlocked' : 'Locked';
            status.className = 'status ' + (isUnlocked ? 'unlocked' : 'locked');
        }

        function renderEntries() {
            const panel = document.getElementById('entries');
            if (!isUnlocked || entries.length === 0) {
                panel.style.display = 'none';
                return;
            }
            panel.style.display = 'block';
            panel.innerHTML = entries.map(e => `
                <div class="entry">
                    <div>
                        <div class="entry-name">${e.name}</div>
                        <div class="entry-user">${e.username || '-'}</div>
                    </div>
                    <div class="entry-actions">
                        <button class="btn" onclick="copyPassword('${e.id}')">Copy</button>
                        <button class="btn" onclick="runCmd('get ${e.name}')">View</button>
                    </div>
                </div>
            `).join('');
        }

        function copyPassword(id) {
            const entry = entries.find(e => e.id === id);
            if (entry?.password) {
                navigator.clipboard.writeText(entry.password).then(() => {
                    print(`Password copied for: ${entry.name}`, 'success');
                });
            }
        }

        // Handle Enter in modals
        document.getElementById('unlockPassword').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') doUnlock();
        });
    </script>
</body>
</html>
